[general]
static=yes
writeprotect=no
clearglobalvars=no

[internal]
; Llamadas entre extensiones locales
exten => 1001,1,NoOp(Llamando a extensión 1001)
exten => 1001,n,Dial(SIP/1001,20)
exten => 1001,n,Hangup()

exten => 1002,1,NoOp(Llamando a extensión 1002)
exten => 1002,n,Dial(SIP/1002,20)
exten => 1002,n,Hangup()

exten => 2000,1,NoOp(Llamando a WebRTC 2000)
exten => 2000,n,Dial(SIP/2000,20)
exten => 2000,n,Hangup()

exten => 2001,1,NoOp(Llamando a WebRTC 2001)
exten => 2001,n,Dial(SIP/2001,20)
exten => 2001,n,Hangup()

; Llamadas salientes a Colombia a través de Twilio
; Marca 9 + 57 + número colombiano (10 dígitos)
; Ejemplo: 9573001234567
exten => _957XXXXXXXXXX,1,NoOp(Llamada saliente a Colombia: +${EXTEN:1})
exten => _957XXXXXXXXXX,n,NoOp(Desde: ${CALLERID(num)})
exten => _957XXXXXXXXXX,n,Set(CALLERID(num)=+14648007398)
exten => _957XXXXXXXXXX,n,Set(CALLERID(name)=WebRTC User)
exten => _957XXXXXXXXXX,n,Dial(SIP/+${EXTEN:1}@twilio-trunk,60,tT)
exten => _957XXXXXXXXXX,n,NoOp(Estado de llamada: ${DIALSTATUS})
exten => _957XXXXXXXXXX,n,GotoIf($["${DIALSTATUS}" = "BUSY"]?busy:unavail)
exten => _957XXXXXXXXXX,n(unavail),Playback(number-not-answering)
exten => _957XXXXXXXXXX,n,Hangup()
exten => _957XXXXXXXXXX,n(busy),Playback(number-busy-try-later)
exten => _957XXXXXXXXXX,n,Hangup()

; Opción alternativa: marcar directamente con formato internacional
; Marca 00 + 57 + número
exten => _0057XXXXXXXXXX,1,NoOp(Llamada a Colombia: +${EXTEN:2})
exten => _0057XXXXXXXXXX,n,Set(CALLERID(num)=+14648007398)
exten => _0057XXXXXXXXXX,n,Set(CALLERID(name)=WebRTC User)
exten => _0057XXXXXXXXXX,n,Dial(SIP/+${EXTEN:2}@twilio-trunk,60,tT)
exten => _0057XXXXXXXXXX,n,Hangup()

; Llamadas de emergencia (opcional)
exten => 911,1,NoOp(Llamada de emergencia)
exten => 911,n,Dial(SIP/911@twilio-trunk)
exten => 911,n,Hangup()

[from-twilio]
; Contexto para llamadas entrantes desde Twilio

; Llamada entrante al número principal de Twilio
exten => _+1464800XXXX,1,NoOp(======================================)
exten => _+1464800XXXX,n,NoOp(Llamada entrante desde: ${CALLERID(num)})
exten => _+1464800XXXX,n,NoOp(Hacia: ${EXTEN})
exten => _+1464800XXXX,n,NoOp(======================================)
exten => _+1464800XXXX,n,Answer()
exten => _+1464800XXXX,n,Wait(1)
exten => _+1464800XXXX,n,Set(TIMEOUT(absolute)=1800)
; Hacer sonar TODAS las extensiones simultáneamente
exten => _+1464800XXXX,n,Dial(SIP/2000&SIP/2001&SIP/1001&SIP/1002,30,tT)
exten => _+1464800XXXX,n,NoOp(Estado: ${DIALSTATUS})
exten => _+1464800XXXX,n,GotoIf($["${DIALSTATUS}" = "NOANSWER"]?voicemail:hangup)
exten => _+1464800XXXX,n(voicemail),Voicemail(1001@default,u)
exten => _+1464800XXXX,n(hangup),Hangup()

; Específicamente para tu número de Twilio
exten => +14648007398,1,Goto(from-twilio,_+1464800XXXX,1)
exten => 14648007398,1,Goto(from-twilio,_+1464800XXXX,1)

; Extensión 's' para llamadas sin DID específico
exten => s,1,NoOp(======================================)
exten => s,n,NoOp(Llamada entrante sin DID desde: ${CALLERID(num)})
exten => s,n,NoOp(======================================)
exten => s,n,Answer()
exten => s,n,Wait(1)
exten => s,n,Dial(SIP/2000&SIP/2001&SIP/1001&SIP/1002,30,tT)
exten => s,n,Voicemail(1001@default,u)
exten => s,n,Hangup()

; Manejo de cualquier otro número
exten => _X.,1,NoOp(Número no reconocido: ${EXTEN})
exten => _X.,n,Goto(s,1)